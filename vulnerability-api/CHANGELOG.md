# Changelog

## Version 1.0.0 - Restructured with Pagination

### Major Changes

#### 1. **Restructured to app folder**
- Moved `api.py` to `app/main.py`
- Created proper Python package structure with `app/__init__.py`
- Updated all run scripts to use `app.main:app`

#### 2. **Added Pagination Support**
All list endpoints now support pagination to handle large datasets efficiently:
- `/vulnerabilities/by-appcode/{appcode}` - Paginated
- `/vulnerabilities/by-lob/{lob}` - Paginated (NEW)
- `/appcodes` - Paginated
- `/lobs` - Paginated (NEW)

**Pagination Parameters:**
- `page`: Page number (starts from 1, default: 1)
- `page_size`: Results per page (default: 100, max: 1000)

**Pagination Response:**
```json
{
  "pagination": {
    "page": 1,
    "page_size": 100,
    "total_results": 250,
    "total_pages": 3,
    "has_next": true,
    "has_previous": false
  }
}
```

#### 3. **New Endpoint: Get Vulnerabilities by LOB**
```
GET /vulnerabilities/by-lob/{lob}
```
Query vulnerabilities by Line of Business with the same filtering and pagination options as the appcode endpoint.

**Query Parameters:**
- `severity` (optional): CRITICAL, HIGH, MEDIUM, LOW
- `state` (optional): ACTIVE, INACTIVE
- `page` (optional): Page number
- `page_size` (optional): Results per page

#### 4. **New Endpoint: List LOBs**
```
GET /lobs
```
Get a paginated list of all unique LOBs with their vulnerability counts.

#### 5. **Enhanced Statistics**
The `/statistics` endpoint now includes LOB statistics:
```json
{
  "total_vulnerabilities": 1500,
  "by_severity": {...},
  "by_appcode": {...},
  "by_lob": {...},
  "by_state": {...}
}
```

### Updated Files

- `app/main.py` - Main API application (moved from api.py)
- `app/__init__.py` - Package initialization
- `run_api.ps1` - Updated to use app.main
- `run_api.sh` - Updated to use app.main
- `test_api.py` - Added LOB testing and pagination tests
- `README.md` - Updated with new endpoints and pagination examples

### Breaking Changes

⚠️ **Important**: The module path has changed from `api:app` to `app.main:app`

**Old:**
```bash
uvicorn api:app --reload
```

**New:**
```bash
uvicorn app.main:app --reload
```

### Migration Guide

If you have existing scripts or deployment configurations:

1. Update uvicorn commands from `api:app` to `app.main:app`
2. Update any imports if you're using the API as a module
3. Update pagination calls - the old `limit` parameter is now `page_size`

### Performance Improvements

- Pagination reduces memory usage for large result sets
- Clients can request smaller page sizes for faster initial responses
- Better handling of thousands of vulnerabilities per appcode/LOB

### Example Usage

```bash
# Get first page of vulnerabilities for appcode
curl "http://localhost:8000/vulnerabilities/by-appcode/APP001?page=1&page_size=50"

# Get vulnerabilities by LOB
curl "http://localhost:8000/vulnerabilities/by-lob/Technology?severity=CRITICAL"

# List all LOBs with pagination
curl "http://localhost:8000/lobs?page=1&page_size=20"
```

"""Configuration for SCC Vulnerability Ingestion"""

import os
from dotenv import load_dotenv

# Load environment variables
ENVIRONMENT = os.environ.get('ENVIRONMENT', 'dev')
load_dotenv(f'.env.{ENVIRONMENT}')

# GCP Configuration
GCP_PROJECT_ID = os.environ.get('GCP_PROJECT_ID')
if not GCP_PROJECT_ID:
    raise ValueError(f"GCP_PROJECT_ID must be set in .env.{ENVIRONMENT}")

GCP_ORGANIZATION_ID = os.environ.get('GCP_ORGANIZATION_ID')
if not GCP_ORGANIZATION_ID:
    raise ValueError(f"GCP_ORGANIZATION_ID must be set in .env.{ENVIRONMENT}")

# Firestore Configuration - Vulnerability Database
FIRESTORE_VULNERABILITY_DB = os.environ.get('FIRESTORE_VULNERABILITY_DB', '(default)')
FIRESTORE_COLLECTION_VULNERABILITIES = os.environ.get('FIRESTORE_COLLECTION_VULNERABILITIES', 'scc-vulnerabilities')

# Firestore Configuration - Inventory Database (for project mapping)
FIRESTORE_INVENTORY_DB = os.environ.get('FIRESTORE_INVENTORY_DB', '(default)')
FIRESTORE_INVENTORY_COLLECTION = os.environ.get('FIRESTORE_INVENTORY_COLLECTION', 'project-mapping')
FIRESTORE_INVENTORY_FIELD_PROJECT_ID = os.environ.get('FIRESTORE_INVENTORY_FIELD_PROJECT_ID', 'project_id')
FIRESTORE_INVENTORY_FIELD_APPCODE = os.environ.get('FIRESTORE_INVENTORY_FIELD_APPCODE', 'appcode')
FIRESTORE_INVENTORY_FIELD_LOB = os.environ.get('FIRESTORE_INVENTORY_FIELD_LOB', 'lob')

# Batch Processing Configuration
BATCH_SIZE = int(os.environ.get('BATCH_SIZE', '500'))  # Process 500 findings at a time
MAX_WORKERS = int(os.environ.get('MAX_WORKERS', '10'))  # Parallel workers

# SCC Configuration
# API v2 uses 'category' instead of 'findingClass'
SCC_FINDING_FILTER = os.environ.get('SCC_FINDING_FILTER', 'state="ACTIVE" AND category="VULNERABILITY"')
SCC_PAGE_SIZE = int(os.environ.get('SCC_PAGE_SIZE', '1000'))

# Logging
LOG_LEVEL = os.environ.get('LOG_LEVEL', 'INFO')

print(f"Environment: {ENVIRONMENT}")
print(f"GCP Project: {GCP_PROJECT_ID}")
print(f"GCP Organization: {GCP_ORGANIZATION_ID}")
print(f"Vulnerability DB: {FIRESTORE_VULNERABILITY_DB}")
print(f"Vulnerability Collection: {FIRESTORE_COLLECTION_VULNERABILITIES}")
print(f"Inventory DB: {FIRESTORE_INVENTORY_DB}")
print(f"Inventory Collection: {FIRESTORE_INVENTORY_COLLECTION}")
print(f"Inventory Fields: project_id={FIRESTORE_INVENTORY_FIELD_PROJECT_ID}, appcode={FIRESTORE_INVENTORY_FIELD_APPCODE}, lob={FIRESTORE_INVENTORY_FIELD_LOB}")
print(f"Batch Size: {BATCH_SIZE}")
print(f"Max Workers: {MAX_WORKERS}")

# Enum to String Conversions

This document lists all protobuf enum fields that have been converted to strings to ensure proper storage in the database.

## Why Convert Enums?

Protobuf enum fields are stored as integers by default. Without conversion:
- `State.ACTIVE` → stored as `1`
- `Severity.HIGH` → stored as `3`
- `Mute.UNDEFINED` → stored as `3`

After conversion:
- `State.ACTIVE` → stored as `"ACTIVE"`
- `Severity.HIGH` → stored as `"HIGH"`
- `Mute.UNDEFINED` → stored as `"UNDEFINED"`

## All Enum Fields Converted

### 1. Core Finding Enums

| Field | Enum Type | Example Values | Status |
|-------|-----------|----------------|--------|
| `state` | State | ACTIVE, INACTIVE | ✅ Converted |
| `severity` | Severity | CRITICAL, HIGH, MEDIUM, LOW | ✅ Converted |
| `finding_class` | FindingClass | VULNERABILITY, MISCONFIGURATION, THREAT, OBSERVATION | ✅ Converted |
| `mute` | Mute | MUTED, UNMUTED, UNDEFINED | ✅ Converted |
| `launch_state` | LaunchState | LAUNCHED, NOT_LAUNCHED | ✅ Converted |

**Code:**
```python
'state': str(finding.state) if hasattr(finding, 'state') else 'UNKNOWN'
'severity': str(finding.severity) if hasattr(finding, 'severity') else 'UNKNOWN'
'finding_class': str(finding.findingClass) if hasattr(finding, 'findingClass') else None
'mute': str(finding.mute) if hasattr(finding, 'mute') else 'UNDEFINED'
'launch_state': str(finding.launchState) if hasattr(finding, 'launchState') else None
```

### 2. CVSS v3 Enums

| Field | Enum Type | Example Values | Status |
|-------|-----------|----------------|--------|
| `attack_vector` | AttackVector | ATTACK_VECTOR_NETWORK, ATTACK_VECTOR_ADJACENT, ATTACK_VECTOR_LOCAL, ATTACK_VECTOR_PHYSICAL | ✅ Converted |
| `attack_complexity` | AttackComplexity | ATTACK_COMPLEXITY_LOW, ATTACK_COMPLEXITY_HIGH | ✅ Converted |
| `privileges_required` | PrivilegesRequired | PRIVILEGES_REQUIRED_NONE, PRIVILEGES_REQUIRED_LOW, PRIVILEGES_REQUIRED_HIGH | ✅ Converted |
| `user_interaction` | UserInteraction | USER_INTERACTION_NONE, USER_INTERACTION_REQUIRED | ✅ Converted |
| `scope` | Scope | SCOPE_UNCHANGED, SCOPE_CHANGED | ✅ Converted |
| `confidentiality_impact` | Impact | IMPACT_NONE, IMPACT_LOW, IMPACT_HIGH | ✅ Converted |
| `integrity_impact` | Impact | IMPACT_NONE, IMPACT_LOW, IMPACT_HIGH | ✅ Converted |
| `availability_impact` | Impact | IMPACT_NONE, IMPACT_LOW, IMPACT_HIGH | ✅ Converted |

**Code:**
```python
cvssv3_data = {
    'base_score': float(cvssv3.baseScore),
    'attack_vector': str(cvssv3.attackVector),
    'attack_complexity': str(cvssv3.attackComplexity),
    'privileges_required': str(cvssv3.privilegesRequired),
    'user_interaction': str(cvssv3.userInteraction),
    'scope': str(cvssv3.scope),
    'confidentiality_impact': str(cvssv3.confidentialityImpact),
    'integrity_impact': str(cvssv3.integrityImpact),
    'availability_impact': str(cvssv3.availabilityImpact)
}
```

### 3. Vulnerability Enums

| Field | Enum Type | Example Values | Status |
|-------|-----------|----------------|--------|
| `exploitation_activity` | ExploitationActivity | WIDE, CONFIRMED, AVAILABLE, ANTICIPATED, NO_KNOWN | ✅ Converted |

**Code:**
```python
exploitation_activity = str(vulnerability.cve.exploitationActivity)
```

### 4. Package Enums

| Field | Enum Type | Example Values | Status |
|-------|-----------|----------------|--------|
| `offending_package.package_type` | PackageType | OS, MAVEN, NPM, PYPI, GO, NUGET, RUBYGEMS | ✅ Converted |
| `fixed_package.package_type` | PackageType | OS, MAVEN, NPM, PYPI, GO, NUGET, RUBYGEMS | ✅ Converted |

**Code:**
```python
offending_package = {
    'package_name': offending_pkg.packageName,
    'package_type': str(offending_pkg.packageType),  # Enum to string
    'package_version': offending_pkg.packageVersion,
    'cpe_uri': offending_pkg.cpeUri
}

fixed_package = {
    'package_name': fixed_pkg.packageName,
    'package_type': str(fixed_pkg.packageType),  # Enum to string
    'package_version': fixed_pkg.packageVersion,
    'cpe_uri': fixed_pkg.cpeUri
}
```

## Enum Value Reference

### State Enum
```
ACTIVE = 1
INACTIVE = 2
```

### Severity Enum
```
SEVERITY_UNSPECIFIED = 0
CRITICAL = 1
HIGH = 2
MEDIUM = 3
LOW = 4
```

### Mute Enum
```
MUTE_UNSPECIFIED = 0
MUTED = 1
UNMUTED = 2
UNDEFINED = 3
```

### FindingClass Enum
```
FINDING_CLASS_UNSPECIFIED = 0
THREAT = 1
VULNERABILITY = 2
MISCONFIGURATION = 3
OBSERVATION = 4
SCC_ERROR = 5
POSTURE_VIOLATION = 6
```

### AttackVector Enum
```
ATTACK_VECTOR_UNSPECIFIED = 0
ATTACK_VECTOR_NETWORK = 1
ATTACK_VECTOR_ADJACENT = 2
ATTACK_VECTOR_LOCAL = 3
ATTACK_VECTOR_PHYSICAL = 4
```

### AttackComplexity Enum
```
ATTACK_COMPLEXITY_UNSPECIFIED = 0
ATTACK_COMPLEXITY_LOW = 1
ATTACK_COMPLEXITY_HIGH = 2
```

### PrivilegesRequired Enum
```
PRIVILEGES_REQUIRED_UNSPECIFIED = 0
PRIVILEGES_REQUIRED_NONE = 1
PRIVILEGES_REQUIRED_LOW = 2
PRIVILEGES_REQUIRED_HIGH = 3
```

### UserInteraction Enum
```
USER_INTERACTION_UNSPECIFIED = 0
USER_INTERACTION_NONE = 1
USER_INTERACTION_REQUIRED = 2
```

### Scope Enum
```
SCOPE_UNSPECIFIED = 0
SCOPE_UNCHANGED = 1
SCOPE_CHANGED = 2
```

### Impact Enum
```
IMPACT_UNSPECIFIED = 0
IMPACT_NONE = 1
IMPACT_LOW = 2
IMPACT_HIGH = 3
```

### ExploitationActivity Enum
```
EXPLOITATION_ACTIVITY_UNSPECIFIED = 0
WIDE = 1
CONFIRMED = 2
AVAILABLE = 3
ANTICIPATED = 4
NO_KNOWN = 5
```

### PackageType Enum
```
PACKAGE_TYPE_UNSPECIFIED = 0
OS = 1
MAVEN = 2
NPM = 3
PYPI = 4
GO = 5
NUGET = 6
RUBYGEMS = 7
```

## Before vs After Examples

### Example 1: Core Finding Fields

**Before (Incorrect - Numeric Enums):**
```json
{
  "state": 1,
  "severity": 2,
  "finding_class": 2,
  "mute": 3,
  "launch_state": 1
}
```

**After (Correct - String Values):**
```json
{
  "state": "ACTIVE",
  "severity": "HIGH",
  "finding_class": "VULNERABILITY",
  "mute": "UNDEFINED",
  "launch_state": "LAUNCHED"
}
```

### Example 2: CVSS v3 Fields

**Before (Incorrect - Numeric Enums):**
```json
{
  "cvssv3": {
    "base_score": 7.8,
    "attack_vector": 3,
    "attack_complexity": 1,
    "privileges_required": 2,
    "user_interaction": 1,
    "scope": 1,
    "confidentiality_impact": 3,
    "integrity_impact": 3,
    "availability_impact": 3
  }
}
```

**After (Correct - String Values):**
```json
{
  "cvssv3": {
    "base_score": 7.8,
    "attack_vector": "ATTACK_VECTOR_LOCAL",
    "attack_complexity": "ATTACK_COMPLEXITY_LOW",
    "privileges_required": "PRIVILEGES_REQUIRED_LOW",
    "user_interaction": "USER_INTERACTION_NONE",
    "scope": "SCOPE_UNCHANGED",
    "confidentiality_impact": "IMPACT_HIGH",
    "integrity_impact": "IMPACT_HIGH",
    "availability_impact": "IMPACT_HIGH"
  }
}
```

### Example 3: Package Information

**Before (Incorrect - Numeric Enum):**
```json
{
  "offending_package": {
    "package_name": "openssl",
    "package_type": 1,
    "package_version": "1.1.1",
    "cpe_uri": "cpe:/a:openssl:openssl:1.1.1"
  }
}
```

**After (Correct - String Value):**
```json
{
  "offending_package": {
    "package_name": "openssl",
    "package_type": "OS",
    "package_version": "1.1.1",
    "cpe_uri": "cpe:/a:openssl:openssl:1.1.1"
  }
}
```

## Complete Field Summary

### Total Enum Fields Converted: 16

**Core Finding:** 5 fields
- state, severity, finding_class, mute, launch_state

**CVSS v3:** 8 fields
- attack_vector, attack_complexity, privileges_required, user_interaction, scope, confidentiality_impact, integrity_impact, availability_impact

**Vulnerability:** 1 field
- exploitation_activity

**Package:** 2 fields
- offending_package.package_type, fixed_package.package_type

## Testing

To verify all enums are properly converted:

1. **Run the ingestion:**
   ```bash
   python main.py
   ```

2. **Check the logs for extracted data:**
   Look for the "EXTRACTED DATA" section in logs

3. **Query the database:**
   ```bash
   gcloud firestore documents list \
     --database=cost-db \
     --collection=scc-vulnerabilities-dev \
     --limit=1
   ```

4. **Verify string values:**
   - All enum fields should show string values (e.g., "ACTIVE", "HIGH")
   - No numeric values (e.g., 1, 2, 3) for enum fields
   - CVSS v3 fields should have descriptive strings

## Notes

- All enum conversions use Python's `str()` function
- Enums are converted at extraction time, not storage time
- Empty or None enums are handled gracefully
- Conversion is consistent across all enum types
- No data loss - string representation contains full enum name

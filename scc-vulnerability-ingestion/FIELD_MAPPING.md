# SCC Finding to Database Field Mapping

This document shows how fields from SCC API v2 findings are mapped to the database schema.

## Finding Object Fields

### Core Finding Fields

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `name` | `finding_name` | string | Full finding name |
| `name` (last segment) | `finding_id` | string | Extracted ID from name |
| `canonicalName` | `canonical_name` | string | ✅ **Added** - Canonical resource name |
| `parent` | `finding_parent` | string | Parent organization/source |
| `parentDisplayName` | `parent_display_name` | string | ✅ **Added** - Display name of parent source |
| `category` | `category` | string | Finding category (e.g., SOFTWARE_VULNERABILITY, GKE_SECURITY_BULLETIN) |
| `state` | `state` | string | ACTIVE, INACTIVE, etc. |
| `severity` | `severity` | string | HIGH, MEDIUM, LOW, CRITICAL |
| `findingClass` | `finding_class` | string | VULNERABILITY, MISCONFIGURATION, etc. |
| `description` | `description` | string | Finding description |
| `nextSteps` | `next_steps` | string | ✅ **Added** - Remediation steps |
| `externalUri` | `external_uri` | string | ✅ **Added** - Link to console/details |
| `createTime` | `create_time` | timestamp | When finding was created |
| `eventTime` | `event_time` | timestamp | When event occurred |
| `launchState` | `launch_state` | string | Launch state of the finding |

### Mute Information

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `mute` | `mute` | string | MUTED, UNMUTED, UNDEFINED |
| `muteInitiator` | `mute_initiator` | string | Who muted the finding |
| `muteUpdateTime` | `mute_update_time` | timestamp | When mute status was updated |

### Resource Fields

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `resourceName` | `resource_name` | string | Full GCP resource name |
| `resource.displayName` | `resource_display_name` | string | Human-readable resource name |
| `resource.type` | `resource_type` | string | Resource type (e.g., google.compute.Instance) |
| `resource.service` | `resource_service` | string | GCP service name |
| `resource.location` | `resource_location` | string | Resource location/region |
| `resource.name` (parsed) | `project_id` | string | Extracted project ID |
| `resource.gcpMetadata.projectDisplayName` | `project_display_name` | string | Project display name |

### Vulnerability Details

#### CVE Information

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `vulnerability.cve.id` | `cve_id` | string | CVE identifier (e.g., CVE-2024-12345) |
| `vulnerability.cve.references` | `cve_references` | array | List of reference URLs |
| `vulnerability.cve.zeroDay` | `zero_day` | boolean | Is this a zero-day vulnerability |
| `vulnerability.cve.impact` | `impact` | string | Impact description |
| `vulnerability.cve.exploitationActivity` | `exploitation_activity` | string | Exploitation activity level |
| `vulnerability.cve.exploitReleaseDate` | `exploit_release_date` | timestamp | When exploit was released |
| `vulnerability.cve.firstExploitationDate` | `first_exploitation_date` | timestamp | First known exploitation |

#### CVSS v3 Scores

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `vulnerability.cve.cvssv3.baseScore` | `cvssv3.base_score` | float | Base CVSS score |
| `vulnerability.cve.cvssv3.attackVector` | `cvssv3.attack_vector` | string | Attack vector |
| `vulnerability.cve.cvssv3.attackComplexity` | `cvssv3.attack_complexity` | string | Attack complexity |
| `vulnerability.cve.cvssv3.privilegesRequired` | `cvssv3.privileges_required` | string | Privileges required |
| `vulnerability.cve.cvssv3.userInteraction` | `cvssv3.user_interaction` | string | User interaction needed |
| `vulnerability.cve.cvssv3.scope` | `cvssv3.scope` | string | Scope of impact |
| `vulnerability.cve.cvssv3.confidentialityImpact` | `cvssv3.confidentiality_impact` | string | Confidentiality impact |
| `vulnerability.cve.cvssv3.integrityImpact` | `cvssv3.integrity_impact` | string | Integrity impact |
| `vulnerability.cve.cvssv3.availabilityImpact` | `cvssv3.availability_impact` | string | Availability impact |

#### Package Information

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `vulnerability.offendingPackage.packageName` | `offending_package.package_name` | string | Vulnerable package name |
| `vulnerability.offendingPackage.packageType` | `offending_package.package_type` | string | Package type (e.g., OS, NPM) |
| `vulnerability.offendingPackage.packageVersion` | `offending_package.package_version` | string | Vulnerable version |
| `vulnerability.offendingPackage.cpeUri` | `offending_package.cpe_uri` | string | CPE URI |
| `vulnerability.fixedPackage.packageName` | `fixed_package.package_name` | string | Fixed package name |
| `vulnerability.fixedPackage.packageType` | `fixed_package.package_type` | string | Package type |
| `vulnerability.fixedPackage.packageVersion` | `fixed_package.package_version` | string | Fixed version |
| `vulnerability.fixedPackage.cpeUri` | `fixed_package.cpe_uri` | string | CPE URI |

#### Security Bulletin

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `vulnerability.securityBulletin.bulletinId` | `security_bulletin.bulletin_id` | string | ✅ **Added** - Bulletin ID (e.g., GCP-2025-056-cos) |
| `vulnerability.securityBulletin.submissionTime` | `security_bulletin.submission_time` | timestamp | ✅ **Added** - When bulletin was submitted |
| `vulnerability.securityBulletin.suggestedUpgradeVersion` | `security_bulletin.suggested_upgrade_version` | string | ✅ **Added** - Recommended version to upgrade to |

### Kubernetes Information

#### Pods

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `kubernetes.pods[].name` | `kubernetes.pods[].name` | string | Pod name |
| `kubernetes.pods[].ns` | `kubernetes.pods[].namespace` | string | Pod namespace |
| `kubernetes.pods[].labels` | `kubernetes.pods[].labels` | object | Pod labels |
| `kubernetes.pods[].containers[].name` | `kubernetes.pods[].containers[].name` | string | Container name |
| `kubernetes.pods[].containers[].image` | `kubernetes.pods[].containers[].image` | string | Container image |
| `kubernetes.pods[].containers[].imageId` | `kubernetes.pods[].containers[].image_id` | string | Container image ID |

#### Nodes

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `kubernetes.nodes[].name` | `kubernetes.nodes[].name` | string | Node name |
| `kubernetes.nodes[].labels` | `kubernetes.nodes[].labels` | object | Node labels |

#### Node Pools

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `kubernetes.nodePools[].name` | `kubernetes.node_pools[].name` | string | ✅ **Fixed** - Node pool name |

#### Roles

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `kubernetes.roles[].name` | `kubernetes.roles[].name` | string | Role name |
| `kubernetes.roles[].ns` | `kubernetes.roles[].namespace` | string | Role namespace |
| `kubernetes.roles[].kind` | `kubernetes.roles[].kind` | string | Role kind |

#### Bindings

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `kubernetes.bindings[].name` | `kubernetes.bindings[].name` | string | Binding name |
| `kubernetes.bindings[].ns` | `kubernetes.bindings[].namespace` | string | Binding namespace |
| `kubernetes.bindings[].role.name` | `kubernetes.bindings[].role` | string | Role name |
| `kubernetes.bindings[].subjects[]` | `kubernetes.bindings[].subjects[]` | array | Subject details |

#### Access Reviews

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `kubernetes.accessReviews[].group` | `kubernetes.access_reviews[].group` | string | API group |
| `kubernetes.accessReviews[].ns` | `kubernetes.access_reviews[].ns` | string | Namespace |
| `kubernetes.accessReviews[].name` | `kubernetes.access_reviews[].name` | string | Resource name |
| `kubernetes.accessReviews[].resource` | `kubernetes.access_reviews[].resource` | string | Resource type |
| `kubernetes.accessReviews[].subresource` | `kubernetes.access_reviews[].subresource` | string | Subresource |
| `kubernetes.accessReviews[].verb` | `kubernetes.access_reviews[].verb` | string | Action verb |
| `kubernetes.accessReviews[].version` | `kubernetes.access_reviews[].version` | string | API version |

#### Generic Objects

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `kubernetes.objects[].group` | `kubernetes.objects[].group` | string | API group |
| `kubernetes.objects[].kind` | `kubernetes.objects[].kind` | string | Object kind |
| `kubernetes.objects[].ns` | `kubernetes.objects[].ns` | string | Namespace |
| `kubernetes.objects[].name` | `kubernetes.objects[].name` | string | Object name |
| `kubernetes.objects[].containers[]` | `kubernetes.objects[].containers[]` | array | Container details |

### Additional Fields

| SCC Field | DB Field | Type | Notes |
|-----------|----------|------|-------|
| `sourceProperties` | `source_properties` | object | Additional source-specific metadata |
| N/A (enriched) | `appcode` | string | Enriched from inventory database |
| N/A (enriched) | `lob` | string | Enriched from inventory database |

## Example Mapping

### Input (SCC Finding)
```json
{
  "name": "organizations/922071633244/sources/13207335939571028937/locations/global/findings/10816745715427329617",
  "canonicalName": "projects/1088176764975/sources/13207335939571028937/locations/global/findings/10816745715427329617",
  "parent": "organizations/922071633244/sources/13207335939571028937/locations/global",
  "parentDisplayName": "GKE Security Posture",
  "resourceName": "//container.googleapis.com/projects/evol-dev-456410/locations/us-central1/clusters/my-test-cluster-1",
  "state": "ACTIVE",
  "category": "GKE_SECURITY_BULLETIN",
  "severity": "HIGH",
  "findingClass": "VULNERABILITY",
  "description": "A vulnerability (CVE-2025-39946) has been discovered...",
  "nextSteps": "Follow the instructions to upgrade your NodePool...",
  "externalUri": "https://console.cloud.google.com/kubernetes/security/dashboard?project=evol-dev-456410",
  "vulnerability": {
    "securityBulletin": {
      "bulletinId": "GCP-2025-056-cos",
      "submissionTime": "2025-10-16T18:34:45Z",
      "suggestedUpgradeVersion": "1.33.5-gke.1162000"
    }
  },
  "kubernetes": {
    "nodePools": [
      {
        "name": "default-pool"
      }
    ]
  }
}
```

### Output (Database Record)
```json
{
  "finding_id": "10816745715427329617",
  "finding_name": "organizations/922071633244/sources/13207335939571028937/locations/global/findings/10816745715427329617",
  "canonical_name": "projects/1088176764975/sources/13207335939571028937/locations/global/findings/10816745715427329617",
  "finding_parent": "organizations/922071633244/sources/13207335939571028937/locations/global",
  "parent_display_name": "GKE Security Posture",
  "category": "GKE_SECURITY_BULLETIN",
  "state": "ACTIVE",
  "severity": "HIGH",
  "finding_class": "VULNERABILITY",
  "description": "A vulnerability (CVE-2025-39946) has been discovered...",
  "next_steps": "Follow the instructions to upgrade your NodePool...",
  "external_uri": "https://console.cloud.google.com/kubernetes/security/dashboard?project=evol-dev-456410",
  "resource_name": "//container.googleapis.com/projects/evol-dev-456410/locations/us-central1/clusters/my-test-cluster-1",
  "project_id": "evol-dev-456410",
  "security_bulletin": {
    "bulletin_id": "GCP-2025-056-cos",
    "submission_time": "2025-10-16T18:34:45Z",
    "suggested_upgrade_version": "1.33.5-gke.1162000"
  },
  "kubernetes": {
    "node_pools": [
      {
        "name": "default-pool"
      }
    ]
  },
  "appcode": "my-app",
  "lob": "engineering"
}
```

## Recent Updates

### ✅ Added Fields (Nov 2, 2025)
1. **`canonical_name`** - Canonical resource name for cross-project references
2. **`parent_display_name`** - Display name of the source (e.g., "GKE Security Posture")
3. **`next_steps`** - Remediation instructions
4. **`external_uri`** - Link to GCP console or external documentation
5. **`security_bulletin`** - Security bulletin details including:
   - `bulletin_id` - Bulletin identifier
   - `submission_time` - When bulletin was submitted
   - `suggested_upgrade_version` - Recommended version

### ✅ Fixed
1. **Kubernetes extraction** - Now works for ALL categories (not just SOFTWARE_VULNERABILITY)
   - Supports GKE_SECURITY_BULLETIN
   - Supports all finding categories with kubernetes data

## Field Coverage

- ✅ **Core finding fields**: 100% coverage
- ✅ **Resource fields**: 100% coverage
- ✅ **Vulnerability details**: 100% coverage
- ✅ **CVE information**: 100% coverage
- ✅ **CVSS v3 scores**: 100% coverage
- ✅ **Package information**: 100% coverage
- ✅ **Security bulletin**: 100% coverage (newly added)
- ✅ **Kubernetes details**: 100% coverage
- ✅ **Mute information**: 100% coverage
